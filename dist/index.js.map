{"version":3,"sources":["../src/index.js"],"names":["Discord","logger","dotenv","steem","http","config","triggerBotKey","client","Client","on","info","user","tag","msg","content","substring","args","split","cmd","splice","console","log","message","reply","api","getAccountReferences","err","result","getAccounts","results","map","reputation","formatter","accountWorth","estimateAccountValue","then","name","JSON","parse","json_metadata","profile","about","worth","catch","query","querying","Posts","Votes","PendingPayouts","Comments","steemPrice","sbdPrice","get","low","res","data","Low","high","High","ratio","login","process","env","DISCORD_TOKEN","createServer","request","response","writeHead","contentType","end","listen","PORT"],"mappings":"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","file":"index.js","sourcesContent":["import * as Discord from 'discord.js';\nimport * as logger from 'winston';\nimport * as dotenv from 'dotenv';\nimport * as steem from 'steem';\nimport * as http from 'http';\nimport axios from 'axios';\n\nimport 'babel-polyfill';\n\ndotenv.config();\n\nimport { executeQuery } from './db';\nimport { searchTag } from './sql';\n\n// setting\nconst triggerBotKey = '!';\n\n// start client\nconst client = new Discord.Client();\n\nclient.on('ready', () => {\n    logger.info(`Logged in as ${client.user.tag}!`);\n});\n\nclient.on('message', msg => {\n    logger.info(msg.content);\n\n    if (msg.content.substring(0, 1) == triggerBotKey) {\n        var args = msg.content.substring(1).split(' ');\n        var cmd = args[0];\n        args = args.splice(1);\n        logger.info(`CMD: ${cmd}`);\n        logger.info(`ARGS: ${args}`);\n        console.log(args);\n        let message;\n        switch (cmd) {\n            case 'help':\n                message = `statBot HELP\\n\n                Type \\`!ping\\` to get bot reply 'pong'\\n\n                Type \\`!user <steem_name>\\` to get details of that person (without @)\\n\n                Type \\`!ratio \\` to get steem to sbd ratio from Bittrex\\n\n                Type \\`!tag <tag_name>\\` to get details on votes, comments, topics and pending payout of that certain tags in past 7 days\n                `;\n                msg.reply(message);\n                break;\n            case 'history':\n                steem.api.getAccountReferences(args, function(err, result) {\n                    console.log(err, result);\n                });\n                break;\n\n            case 'user':\n                steem.api.getAccounts(args, function(err, results) {\n                    if (!!results[0]) {\n                        results.map(result => {\n                            if (!!result) {\n                                console.log(result);\n                                let reputation = steem.formatter.reputation(\n                                    result.reputation\n                                );\n                                let accountWorth = steem.formatter.estimateAccountValue(\n                                    result\n                                );\n\n                                accountWorth\n                                    .then(worth => {\n                                        message = `@${result.name} says \"${\n                                            JSON.parse(result.json_metadata)\n                                                .profile.about\n                                        }\"\n                                and reputation: ${reputation} ðŸ”°\n                                and account worth: $${worth} ðŸ’°\n                                `;\n                                        msg.reply(message);\n                                    })\n                                    .catch(err => {\n                                        console.log(err);\n                                    });\n                            } else {\n                                msg.reply('User not found');\n                            }\n                        });\n                    } else {\n                        msg.reply('User not found');\n                    }\n                });\n                break;\n            case 'ping':\n                message = 'Pong!';\n                msg.reply(message);\n                break;\n            case 'tag':\n                msg.reply('Connecting to database....');\n                const query = searchTag(args[0]);\n                async function querying(query, tag) {\n                    let result = await executeQuery(query);\n                    console.log(result);\n                    result === 'ERROR'\n                        ? msg.reply('ERROR ON QUERY-ING')\n                        : msg.reply(\n                              `There is\n                               ${result[0].Posts} posts ðŸ“˜,\n                               ${result[0].Votes} votes ðŸ‘,\n                               $${result[0].PendingPayouts} steem ðŸ’µ,\n                               ${result[0].Comments} comments ðŸ’¬,\n                               on #${tag} in the past 7 days`\n                          );\n                }\n                querying(query, args);\n                break;\n            case 'ratio':\n                let steemPrice;\n                let sbdPrice;\n                axios\n                    .get(\n                        'https://bittrex.com/api/v1.1/public/getmarketsummary?market=btc-steem'\n                    )\n                    .then(res => {\n                        steemPrice = {\n                            low: res.data.result[0].Low,\n                            high: res.data.result[0].High\n                        };\n                        return axios.get(\n                            'https://bittrex.com/api/v1.1/public/getmarketsummary?market=btc-sbd'\n                        );\n                    })\n                    .then(res => {\n                        sbdPrice = {\n                            low: res.data.result[0].Low,\n                            high: res.data.result[0].High\n                        };\n                        console.log(steemPrice);\n                        console.log(sbdPrice);\n                        let ratio = {\n                            low: steemPrice.low / sbdPrice.low,\n                            high: steemPrice.high / sbdPrice.high\n                        };\n                        console.log(ratio);\n                        msg.reply(\n                            `ratio from bittrex: ${ratio.low} <-> ${\n                                ratio.high\n                            } steem/sbd`\n                        );\n                    });\n                break;\n            default:\n                message = '`!help` to get started';\n                msg.reply(message);\n                break;\n        }\n    }\n});\nclient.login(process.env.DISCORD_TOKEN);\nhttp\n    .createServer(function(request, response) {\n        response.writeHead(200, { 'Content-Type': contentType });\n        response.end(content, 'utf-8');\n    })\n    .listen(process.env.PORT || 5000);\n"]}